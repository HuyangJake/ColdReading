---
title: 一次版本发布的启示
date: 2017-05-03 09:17:42
tags: 随笔

---

今天早上怀着惴惴不安的心情，点开了iTunes Connect，等待漫长的loading...

审核通过了！

是不是我对Apple审核太敏感了？😂，只因为这个版本的发布因为审核被拖延好久了😕

刚好这段时间有在看_《程序员的职业素养》_这本书，结合这次的版本发布事故让我收获了新的体会。

<!--more-->

### 事故现场

直接来看事故现场吧：

![](http://ojam5z7vg.bkt.clouddn.com/coldreading/jpg/iTunes_Connect1.png-bigblog)

25号提交版本，27号正常通过审核。当要发布的前一刻，测试姐姐告知我们[<font color=#E84C66>有个功能这个版本不需要上</font>](#1)，于是我们打算启用线上预埋的开关替换这版不需要上的功能的界面，从而正常上线当前等待发布区的版本。然而一切没有那么顺利，料想不到的是这个界面在预埋的处理中[<font color=#E84C66>参数没有正确处理</font>](#2)，导致了上述方案没法正常运行。

只好撤下已经过审的版本，修改问题重新提交。也就是图中圈起来的这一步，也正是这一步开启了万恶的轮回。。。

---
日子慢慢靠近五一假期，项目的上线时间倒没有要去凑节日这样的要求，只是如果在假期中出现线上什么问题，解决起来就没有那么高效，万一涉及到跟其他部门之间的配合修改，可就更加麻烦。毕竟小长假都在happy。

没想到，戏剧性的出现了下图中的这出戏

![](http://ojam5z7vg.bkt.clouddn.com/coldreading/jpg/iTunes_Connect2.png-bigblog)

重新提交后的第二天，被Apple拒绝了。懵逼了，没有修改过其他代码，竟然前一天通过，这天就被拒绝，苹果爸爸果然强势。拒绝原因还让人无法拒绝，“APP的描述图片不符合规范”。这，，我们都已经用了两个版本了。好吧，让视觉大哥重新设计，运营重新提交了审核。现在也就希望五一期间正常上线就行了。

假期第一天29号，仍然被拒。而且被拒原因升级了。Apple审核人员告知我们APP在启动的时候crash了😱，定位了他们提供的奔溃日志后发现，它貌似是平常我们crash收集列表中的一个小概率出现的bug，但是之前一直没有找到根源在哪。

这次拿到的日志信息让我找到了奔溃处的代码，这是同事负责的模块。我找到可疑的地方，问了同事会不会出现我想象的错误导致崩溃，同事说不会，没有遇到过。[<font color=#E84C66>我想着毕竟是他的模块，就不多说了</font>](#3)，同事建议不修改再提交一次审核，我想着这个问题本也是概率出现时，说不定是审核人员运气太好遇到了。于是我们再次提交审核。。。

两天后

5.2小长假结束，回来上班了，打开iTunes Connect发现还是被拒绝了😖，我当时心里的第一感觉是后悔，[<font color=#E84C66>后悔没有去修改那个问题，指不定就过了</font>](#4)。现在要向领导汇报这次失误，还要继续确认问题。写了份上线被拒说明的pdf文档给老大并解释，老大让我赶紧定位问题，修改再提交上线，并语重心长地跟我重申了我们定好的每半个月更新线上版本的计划，告诉我这次的时间太久了。倍感压力和自责。。。

---

按照之前怀疑过的思路继续往下查，我找到了确凿的证据，导致crash的地方果然是那里。

我立马修改了代码重新提交审核，并发了testFlight让测试同学在针对性地点一点，自己也在紧张地review着，心里不断默念着：可不能再被拒绝了啊

![](http://ojam5z7vg.bkt.clouddn.com/coldreading/jpg/iTunes_Connect3.png-bigblog)

然而，折磨我的路口总是一个个不断出现。上午提交后，我在下午的review中发现了一个不大不小的问题，同事测试在iPad版本（因为Apple审核人员使用iPad进行测试）中发现了另外一个问题，让我[<font color=#E84C66>不得不重新撤回审核</font>](#5)，修改了问题代码重新提交。这样断断续续折腾了一天。


终于在5.3，今天早上得到了一个好消息，磨人的审核。

### 感悟
红色字体的地方都是我感悟的触发点。



* <span id=2 ><font color=#E84C66>“参数没有正确处理”</font></span>

《程序员的职业素养》中提到一个高效工作的状态称作流态区。__当人处在流态区中，其实是处在了一种浅层的冥想之中，会追求工作的速度，理性思考的能力会下降。__当然我觉得，这当然排除需要高强度脑力思考的工作。但是这种强度在平常工作中基本遇不到。

为了尽快完成任务，我常会陷入流态区，预埋开关这种平常用不到的参数设置就没有注意去设置，并且没有去验证保证正确。__为了完成某个任务而省略了验证的步骤往往会给自己往后增加更多的麻烦。__

* <span id=1><font color=#E84C66>有个功能这个版本不需要上</font></span>

测试同学在我们要上线的时候告诉我们那个功能不用上线，这个也是挺冤枉的，但是也该怪我们自己。这个功能前个版本就做好了，没有明说上不上，上版本上了让撤下来，这次上了又让撤下来。怪在我们一直拖着没有去确认清楚准确的时间，就算拿不到准确的时间也该在提交这次版本之前去确认这版要不要上。更好的解决办法是，在这里的配置一个这个功能的开关，可以在线上控制就免去这个麻烦。__得过且过的惰性抑制了生产力__



>如果希望自己的软件灵活可变，那就应该时常修改它！

>让软件保持固定不变是危险的！如果一直不重构代码，等到最后不得不重构时，就会发现代码已经僵化了。

> 时常修改，并且大刀阔斧地修改的前提保证最好要有一套覆盖了代码的自动化测试。  不害怕修改代码那就是一直在改。


像《程序员的职业素养》中提到，代码就的时常优化，我有一个版本的时间，却没有去优化这个功能，造成了后面一系列的问题😫



* <span id=3><font color=#E84C66>我想着毕竟是他的模块，就不多说了</font></span>

不得不承认，当时想着是这是同事的模块，我也询问过是否出现有我考虑到的问题，最后要是还有问题那就没有我什么责任了。

太傻！典型的缺失责任感，我知道我对那段代码存在怀疑，同事告知不会有问题也并没有说服我。不知道可选值是否可能为空的情况下对一个可选值强制解包，我第一反应是添加一个判空。没有坚持，觉得问题跟自己没多大关系，是个大错误。

发现了潜在的问题，并且是在审核的关键阶段，提出并去验证检查是该有责任。

* <span id=4><font color=#E84C66>后悔没有去修改那个问题，指不定就过了</font></span>

在问题发生后再去想这样的事，也是个错误。这种思维回想过来无非是对之前同事判断的否定，并带着责怪。仔细想想，我自己不也是是同意了这样子去做了吗？！没有坚持去追究发现的问题，也想投机取巧想着轻松过关，没有认真对待这个问题。

* <span id=5><font color=#E84C66>不得不重新撤回审核</font></span>

在再次提交这个版本的时候，老大有问过两次还有没有发现其他问题。满口地回答了没有，没想到还是中招了。自我审查的责任感，还需要提高，__不能把测试组当成是抓虫机器__。当初真的在这样的思想上栽了大跟头，还需要不断地改善。

